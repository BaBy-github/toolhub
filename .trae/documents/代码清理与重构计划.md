# 代码清理与重构计划

## 1. 删除旧兼容逻辑

### ToDiff.vue
- 删除第24-30行的旧兼容逻辑，只保留从toolState获取初始值的代码
- 原因：现在已经使用toolState来传递状态，不再需要URL参数兼容

## 2. 检查其他文件的兼容逻辑

### ToJson.vue 和 ToXml.vue
- 保留对`route.query.input`的处理，因为这些页面可能需要支持直接通过URL访问
- 原因：这些页面作为入口点，可能需要支持用户直接访问并传递参数

## 3. 提取公共逻辑到Composables

### 创建 `useToolState` Composable
- 提取从toolState获取初始值的逻辑
- 提取goBack函数的实现
- 提取pushToolState的调用逻辑

### 创建 `useEditorState` Composable
- 提取编辑器相关的状态管理（input, output, showOutput等）
- 提取输入变化处理逻辑
- 提取历史记录和撤销功能

## 4. 改进ConversionButton组件

### 修复ToJson.vue和ToXml.vue中的模板错误
- 在ConversionButton的@conversion回调中，直接传递ref值而不是ref对象
- 错误：`setNextToolInput(output)` 应该是 `setNextToolInput(output.value)`

## 5. 测试验证

### 功能测试
- 验证从一个工具跳转到另一个工具时，状态正确传递
- 验证返回上一个工具时，状态正确恢复
- 验证直接访问工具页面时，URL参数仍能正常工作

### UI测试
- 验证转换按钮和下拉菜单正常工作
- 验证输出框正常显示
- 验证编辑器功能正常

## 6. 代码质量检查

### 运行TypeScript检查
- 确保没有类型错误

### 运行构建命令
- 确保项目能够正常构建

## 7. 优化建议

### 统一工具页面的结构
- 确保所有工具页面的布局和功能保持一致
- 提高用户体验的一致性

### 增加工具间的转换动画
- 为工具间的跳转添加平滑过渡效果
- 提高用户体验

### 改进状态管理
- 考虑使用Pinia或Vuex进行更复杂的状态管理
- 目前的toolState实现已经足够，但对于未来的扩展可能不够灵活